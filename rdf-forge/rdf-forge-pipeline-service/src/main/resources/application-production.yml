# Production Environment Configuration for Pipeline Service
spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    hikari:
      maximum-pool-size: ${DB_POOL_SIZE:20}
      minimum-idle: ${DB_POOL_MIN:10}
      connection-timeout: 30000
      leak-detection-threshold: 60000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        generate_statistics: false

  flyway:
    enabled: true
    validate-on-migrate: true

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI}
          jwk-set-uri: ${KEYCLOAK_JWK_URI}

# Service discovery
services:
  job-service:
    url: ${JOB_SERVICE_URL}
  shacl-service:
    url: ${SHACL_SERVICE_URL}
  data-service:
    url: ${DATA_SERVICE_URL}

# Production actuator configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: production

# Resilience configuration for production
resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 20
        failureRateThreshold: 50
        waitDurationInOpenState: 30000
        permittedNumberOfCallsInHalfOpenState: 5
        slowCallDurationThreshold: 10000
        slowCallRateThreshold: 50
  retry:
    configs:
      default:
        maxAttempts: 3
        waitDuration: 1000
  timelimiter:
    configs:
      default:
        timeoutDuration: 30s

# Production logging - use structured JSON logging
logging:
  level:
    root: WARN
    io.rdfforge: INFO
    org.springframework: WARN
    org.hibernate: WARN
    org.apache.jena: WARN
  pattern:
    console: "%d{yyyy-MM-dd'T'HH:mm:ss.SSSZ} [%thread] [%X{traceId}] [%X{spanId}] %-5level %logger{36} - %msg%n"