<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="cube-wizard">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <i class="pi pi-box header-icon"></i>
      <div>
        <h1>Create Data Cube</h1>
        <p class="header-subtitle">Build an RDF Data Cube from your tabular data</p>
      </div>
    </div>
    <div class="header-actions">
      <p-button label="Cancel" icon="pi pi-times" severity="secondary" [text]="true" routerLink="/"></p-button>
    </div>
  </div>

  <!-- Progress Steps -->
  <div class="step-indicators">
    @for (step of ['Basic Info', 'Data Source', 'Mapping', 'Metadata', 'Validate', 'Publish']; track step; let i = $index) {
      <div class="step-indicator"
           [class.completed]="getStepStatus(i) === 'completed'"
           [class.current]="getStepStatus(i) === 'current'"
           [class.clickable]="i <= maxStepReached()"
           (click)="goToStep(i)">
        <div class="step-number">
          @if (getStepStatus(i) === 'completed') {
            <i class="pi pi-check"></i>
          } @else {
            {{ i + 1 }}
          }
        </div>
        <div class="step-label">{{ step }}</div>
      </div>
      @if (i < 5) {
        <div class="step-connector" [class.completed]="getStepStatus(i) === 'completed'"></div>
      }
    }
  </div>

  <!-- Main Content -->
  <div class="wizard-content">
    <!-- Step 0: Basic Info -->
    @if (activeStep() === 0) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-info-circle"></i>
          <div>
            <h2>Cube Information</h2>
            <p>Define the basic properties of your data cube</p>
          </div>
        </div>

        <div class="form-content">
          <div class="form-section">
            <div class="form-field">
              <label for="cubeName">Cube Name <span class="required">*</span></label>
              <input id="cubeName" type="text" pInputText [ngModel]="cubeName()" (ngModelChange)="cubeName.set($event)"
                     placeholder="e.g., Population Statistics 2024" class="w-full" />
              <small>A descriptive name for your data cube</small>
            </div>

            <div class="form-field">
              <label for="cubeDesc">Description</label>
              <textarea id="cubeDesc" pTextarea [ngModel]="cubeDescription()" (ngModelChange)="cubeDescription.set($event)"
                        rows="3" placeholder="Describe the content and purpose of this cube..." class="w-full"></textarea>
            </div>

            <div class="form-row">
              <div class="form-field">
                <label for="baseUri">Base URI <span class="required">*</span></label>
                <input id="baseUri" type="text" pInputText [ngModel]="baseUri()" (ngModelChange)="baseUri.set($event)"
                       placeholder="https://example.org/cube/" class="w-full" />
                <small>The namespace for all cube resources</small>
              </div>

              <div class="form-field">
                <label for="cubeId">Cube Identifier</label>
                <div class="id-input-group">
                  <p-checkbox [ngModel]="useAutoId()" (ngModelChange)="useAutoId.set($event)" [binary]="true" inputId="autoId"></p-checkbox>
                  <label for="autoId" class="auto-id-label">Auto-generate from name</label>
                </div>
                @if (useAutoId()) {
                  <div class="generated-id">
                    <code>{{ generatedId() || '...' }}</code>
                  </div>
                } @else {
                  <input type="text" pInputText [ngModel]="cubeId()" (ngModelChange)="cubeId.set($event)"
                         placeholder="my-cube-id" class="w-full" />
                }
              </div>
            </div>
          </div>

          @if (cubeName() && baseUri()) {
            <div class="preview-box">
              <label>Full Cube URI:</label>
              <code>{{ baseUri() }}{{ useAutoId() ? generatedId() : cubeId() }}</code>
            </div>
          }
        </div>
      </div>
    }

    <!-- Step 1: Data Source -->
    @if (activeStep() === 1) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-database"></i>
          <div>
            <h2>Select Data Source</h2>
            <p>Choose an existing data source or upload a new file</p>
          </div>
        </div>

        <div class="form-content">
          <div class="source-type-selector">
            <p-selectButton [options]="sourceTypeOptions" [ngModel]="sourceType()" (ngModelChange)="sourceType.set($event)"
                           optionLabel="label" optionValue="value"></p-selectButton>
          </div>

          @if (sourceType() === 'existing') {
            <div class="data-source-list">
              @if (loadingDataSources()) {
                <div class="loading-state">
                  <i class="pi pi-spin pi-spinner"></i>
                  <span>Loading data sources...</span>
                </div>
              } @else if (dataSources().length === 0) {
                <div class="empty-state">
                  <i class="pi pi-inbox"></i>
                  <h4>No Data Sources</h4>
                  <p>Upload a file to get started</p>
                  <p-button label="Upload File" icon="pi pi-upload" (onClick)="sourceType.set('upload')"></p-button>
                </div>
              } @else {
                <div class="source-grid">
                  @for (source of dataSources(); track source.id) {
                    <div class="source-card"
                         [class.selected]="selectedDataSource()?.id === source.id"
                         (click)="onDataSourceSelect(source)">
                      <div class="source-icon">
                        <i class="pi" [class.pi-file-excel]="source.format === 'csv' || source.format === 'xlsx'"
                                       [class.pi-file]="source.format !== 'csv' && source.format !== 'xlsx'"></i>
                      </div>
                      <div class="source-info">
                        <div class="source-name">{{ source.name }}</div>
                        <div class="source-meta">
                          <span class="source-format">{{ source.format }}</span>
                          @if (source.rowCount) {
                            <span class="source-rows">{{ source.rowCount | number }} rows</span>
                          }
                        </div>
                      </div>
                      @if (selectedDataSource()?.id === source.id) {
                        <i class="pi pi-check-circle selected-icon"></i>
                      }
                    </div>
                  }
                </div>
              }
            </div>
          } @else {
            <div class="upload-section">
              <p-accordion>
                <p-accordion-panel value="options">
                  <p-accordion-header>
                    <i class="pi pi-cog"></i>
                    <span>CSV Options</span>
                  </p-accordion-header>
                  <p-accordion-content>
                    <div class="options-grid">
                      <div class="form-field">
                        <label>Delimiter</label>
                        <p-select [options]="delimiterOptions" [ngModel]="delimiter()" (ngModelChange)="delimiter.set($event)"
                                 optionLabel="label" optionValue="value" styleClass="w-full"></p-select>
                      </div>
                      <div class="form-field">
                        <label>Encoding</label>
                        <p-select [options]="encodingOptions" [ngModel]="encoding()" (ngModelChange)="encoding.set($event)"
                                 optionLabel="label" optionValue="value" styleClass="w-full"></p-select>
                      </div>
                      <div class="form-field checkbox-field">
                        <p-checkbox [ngModel]="hasHeader()" (ngModelChange)="hasHeader.set($event)" [binary]="true" inputId="hasHeader"></p-checkbox>
                        <label for="hasHeader">First row contains headers</label>
                      </div>
                    </div>
                  </p-accordion-content>
                </p-accordion-panel>
              </p-accordion>

              <div class="upload-dropzone" [class.uploading]="uploading()">
                <p-fileUpload mode="advanced" [customUpload]="true" (uploadHandler)="onFileSelect($event)"
                             accept=".csv,.xls,.xlsx,.tsv" [maxFileSize]="50000000"
                             chooseLabel="Choose File" uploadLabel="Upload" [auto]="true"
                             [showUploadButton]="false" [showCancelButton]="false">
                  <ng-template pTemplate="content">
                    <div class="upload-content">
                      @if (uploading()) {
                        <i class="pi pi-spin pi-spinner"></i>
                        <p>Uploading...</p>
                      } @else {
                        <i class="pi pi-cloud-upload"></i>
                        <p>Drag and drop files here or click to browse</p>
                        <small>Supported formats: CSV, XLS, XLSX, TSV (max 50MB)</small>
                      }
                    </div>
                  </ng-template>
                </p-fileUpload>
              </div>
            </div>
          }

          <!-- Data Preview -->
          @if (selectedDataSource()) {
            <div class="data-preview-section">
              <div class="section-title">
                <i class="pi pi-eye"></i>
                <span>Data Preview</span>
                <p-tag [value]="selectedDataSource()?.name || ''" severity="info"></p-tag>
              </div>
              @if (loadingColumns()) {
                <div class="loading-state small">
                  <i class="pi pi-spin pi-spinner"></i>
                  <span>Analyzing data...</span>
                </div>
              } @else {
                <app-data-preview [dataSourceId]="selectedDataSource()?.id || null"></app-data-preview>
              }
            </div>
          }
        </div>
      </div>
    }

    <!-- Step 2: Column Mapping -->
    @if (activeStep() === 2) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-sitemap"></i>
          <div>
            <h2>Map Columns</h2>
            <p>Define how each column maps to RDF cube components</p>
          </div>
        </div>

        <div class="form-content">
          <!-- Mapping Stats -->
          <div class="mapping-stats">
            <div class="stat-badge dimension">
              <i class="pi pi-th-large"></i>
              <span>{{ mappingStats().dimensions }} Dimensions</span>
            </div>
            <div class="stat-badge measure">
              <i class="pi pi-chart-bar"></i>
              <span>{{ mappingStats().measures }} Measures</span>
            </div>
            <div class="stat-badge attribute">
              <i class="pi pi-tag"></i>
              <span>{{ mappingStats().attributes }} Attributes</span>
            </div>
            @if (mappingStats().ignored > 0) {
              <div class="stat-badge ignored">
                <i class="pi pi-eye-slash"></i>
                <span>{{ mappingStats().ignored }} Ignored</span>
              </div>
            }
            <div class="stat-actions">
              <p-button label="Auto-Assign Dimensions" icon="pi pi-magic" [text]="true" size="small"
                       (onClick)="autoAssignDimensions()" pTooltip="Match columns to existing dimensions by name"></p-button>
            </div>
          </div>

          <!-- Mapping Table -->
          <p-table [value]="columnMappings()" styleClass="p-datatable-sm mapping-table" [scrollable]="true" scrollHeight="400px">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 180px">Column</th>
                <th style="width: 140px">Role</th>
                <th style="width: 140px">Datatype</th>
                <th>Dimension Reference</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-mapping let-i="rowIndex">
              <tr [class.ignored-row]="mapping.role === 'ignore'">
                <td>
                  <div class="column-info">
                    <span class="column-name">{{ mapping.name }}</span>
                    <span class="column-type">{{ mapping.sourceType }}</span>
                  </div>
                </td>
                <td>
                  <p-select [options]="roleOptions" [ngModel]="mapping.role"
                           (ngModelChange)="updateMapping(i, 'role', $event)"
                           optionLabel="label" optionValue="value" styleClass="w-full">
                    <ng-template let-item pTemplate="selectedItem">
                      <div class="role-item">
                        <p-tag [value]="item.label" [severity]="getRoleSeverity(item.value)"></p-tag>
                      </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                      <div class="role-option">
                        <p-tag [value]="item.label" [severity]="getRoleSeverity(item.value)"></p-tag>
                        <small>{{ item.description }}</small>
                      </div>
                    </ng-template>
                  </p-select>
                </td>
                <td>
                  <p-select [options]="datatypeOptions" [ngModel]="mapping.datatype"
                           (ngModelChange)="updateMapping(i, 'datatype', $event)"
                           optionLabel="label" optionValue="value" styleClass="w-full"
                           [disabled]="mapping.role === 'ignore'"></p-select>
                </td>
                <td>
                  @if (mapping.role === 'dimension') {
                    <div class="dimension-select-group">
                      <p-select [options]="availableDimensions()" [ngModel]="mapping.dimensionId"
                               (ngModelChange)="updateMapping(i, 'dimensionId', $event)"
                               optionLabel="name" optionValue="id" placeholder="Link to dimension..."
                               [showClear]="true" styleClass="flex-1" [filter]="true"></p-select>
                      <p-button icon="pi pi-plus" [text]="true" severity="secondary" size="small"
                               (onClick)="openNewDimensionDialog(mapping.name)" pTooltip="Create new dimension"></p-button>
                    </div>
                  } @else {
                    <span class="text-muted">-</span>
                  }
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="4" class="text-center">
                  <div class="empty-hint">
                    <i class="pi pi-info-circle"></i>
                    <p>Select a data source to see column mappings</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>

          @if (mappingStats().dimensions === 0 || mappingStats().measures === 0) {
            <div class="validation-hint warning">
              <i class="pi pi-exclamation-triangle"></i>
              <span>A valid cube requires at least one dimension and one measure</span>
            </div>
          }
        </div>
      </div>
    }

    <!-- Step 3: Metadata -->
    @if (activeStep() === 3) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-tags"></i>
          <div>
            <h2>Cube Metadata</h2>
            <p>Add Dublin Core metadata to describe your data cube</p>
          </div>
        </div>

        <div class="form-content">
          <div class="form-section">
            <h3>Basic Information</h3>
            <div class="form-row">
              <div class="form-field">
                <label for="metaTitle">Title <span class="required">*</span></label>
                <input id="metaTitle" type="text" pInputText [ngModel]="metadata().title"
                       (ngModelChange)="updateMetadataTitle($event)" class="w-full" />
              </div>
              <div class="form-field">
                <label for="metaLang">Language</label>
                <p-select id="metaLang" [options]="languageOptions" [ngModel]="metadata().language"
                         (ngModelChange)="updateMetadataLanguage($event)"
                         optionLabel="label" optionValue="value" styleClass="w-full"></p-select>
              </div>
            </div>

            <div class="form-field">
              <label for="metaDesc">Description</label>
              <textarea id="metaDesc" pTextarea [ngModel]="metadata().description"
                       (ngModelChange)="updateMetadataDescription($event)"
                       rows="3" class="w-full"></textarea>
            </div>
          </div>

          <p-divider></p-divider>

          <div class="form-section">
            <h3>Publisher & License</h3>
            <div class="form-row">
              <div class="form-field">
                <label for="metaPub">Publisher</label>
                <input id="metaPub" type="text" pInputText [ngModel]="metadata().publisher"
                       (ngModelChange)="updateMetadataPublisher($event)"
                       placeholder="Organization name" class="w-full" />
              </div>
              <div class="form-field">
                <label for="metaLicense">License <span class="required">*</span></label>
                <p-select id="metaLicense" [options]="licenseOptions" [ngModel]="metadata().license"
                         (ngModelChange)="updateMetadataLicense($event)"
                         optionLabel="label" optionValue="value" placeholder="Select license..." styleClass="w-full"></p-select>
              </div>
            </div>
          </div>

          <p-divider></p-divider>

          <div class="form-section">
            <h3>Additional Properties</h3>
            <div class="form-row">
              <div class="form-field">
                <label for="metaIssued">Issued Date</label>
                <input id="metaIssued" type="date" pInputText [ngModel]="metadata().issued"
                       (ngModelChange)="updateMetadataIssued($event)" class="w-full" />
              </div>
              <div class="form-field">
                <label for="metaPeriod">Accrual Periodicity</label>
                <p-select id="metaPeriod" [options]="periodicityOptions" [ngModel]="metadata().accrualPeriodicity"
                         (ngModelChange)="updateMetadataAccrualPeriodicity($event)"
                         optionLabel="label" optionValue="value" placeholder="How often updated?" styleClass="w-full"></p-select>
              </div>
            </div>

            <div class="form-field">
              <label for="metaKeywords">Keywords</label>
              <input id="metaKeywords" type="text" pInputText [ngModel]="keywordsInput()"
                     (ngModelChange)="keywordsInput.set($event)"
                     placeholder="statistics, population, census (comma separated)" class="w-full" />
              <small>Separate multiple keywords with commas</small>
            </div>

            <div class="form-row">
              <div class="form-field">
                <label for="metaSpatial">Spatial Coverage</label>
                <input id="metaSpatial" type="text" pInputText [ngModel]="metadata().spatial"
                       (ngModelChange)="updateMetadataSpatial($event)"
                       placeholder="e.g., Switzerland, Europe" class="w-full" />
              </div>
              <div class="form-field">
                <label for="metaTemporal">Temporal Coverage</label>
                <input id="metaTemporal" type="text" pInputText [ngModel]="metadata().temporal"
                       (ngModelChange)="updateMetadataTemporal($event)"
                       placeholder="e.g., 2020-2024" class="w-full" />
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Step 4: Validate -->
    @if (activeStep() === 4) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-check-circle"></i>
          <div>
            <h2>Validation & Preview</h2>
            <p>Verify your cube configuration before publishing</p>
          </div>
        </div>

        <div class="form-content">
          <!-- Validation Section -->
          <div class="validation-section">
            <div class="validation-header">
              <h3>Validation Checks</h3>
              <p-button label="Run Validation" icon="pi pi-play" (onClick)="runValidation()"
                       [loading]="validating()" [disabled]="validating()"></p-button>
            </div>

            <div class="validation-list">
              @for (check of validationChecks(); track check.id) {
                <div class="validation-item" [class]="'status-' + check.status">
                  <div class="validation-icon">
                    <i class="pi" [class]="getValidationIcon(check.status)"></i>
                  </div>
                  <div class="validation-info">
                    <div class="validation-name">{{ check.name }}</div>
                    <div class="validation-desc">{{ check.description }}</div>
                    @if (check.message) {
                      <div class="validation-message">{{ check.message }}</div>
                    }
                  </div>
                  <p-tag [value]="check.status | titlecase" [severity]="getValidationSeverity(check.status)"></p-tag>
                </div>
              }
            </div>

            @if (validationComplete()) {
              <div class="validation-summary" [class.success]="validationSummary().failed === 0">
                @if (validationSummary().failed === 0) {
                  <i class="pi pi-check-circle"></i>
                  <span>All validations passed! Ready to publish.</span>
                } @else {
                  <i class="pi pi-times-circle"></i>
                  <span>{{ validationSummary().failed }} validation(s) failed. Please fix issues before proceeding.</span>
                }
              </div>
            }
          </div>

          <p-divider></p-divider>

          <!-- Preview Section -->
          <div class="preview-section">
            <div class="preview-header">
              <h3>Generated Output Preview</h3>
              <div class="preview-tabs">
                <p-button label="DSD" [text]="previewTab() !== 'dsd'" [severity]="previewTab() === 'dsd' ? 'primary' : 'secondary'"
                         size="small" (onClick)="previewTab.set('dsd')"></p-button>
                <p-button label="Turtle" [text]="previewTab() !== 'turtle'" [severity]="previewTab() === 'turtle' ? 'primary' : 'secondary'"
                         size="small" (onClick)="previewTab.set('turtle')"></p-button>
                <p-button label="Pipeline" [text]="previewTab() !== 'pipeline'" [severity]="previewTab() === 'pipeline' ? 'primary' : 'secondary'"
                         size="small" (onClick)="previewTab.set('pipeline')"></p-button>
              </div>
            </div>

            <div class="preview-content">
              <div class="preview-toolbar">
                <p-button icon="pi pi-copy" [text]="true" size="small" pTooltip="Copy to clipboard"
                         (onClick)="copyToClipboard(previewTab() === 'dsd' ? generateDsdPreview() : previewTab() === 'turtle' ? generateTurtlePreview() : generatePipelinePreview())"></p-button>
              </div>
              <pre class="preview-code">@switch (previewTab()) {
                @case ('dsd') { {{ generateDsdPreview() }} }
                @case ('turtle') { {{ generateTurtlePreview() }} }
                @case ('pipeline') { {{ generatePipelinePreview() }} }
              }</pre>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Step 5: Publish -->
    @if (activeStep() === 5) {
      <div class="step-panel">
        <div class="step-header">
          <i class="pi pi-cloud-upload"></i>
          <div>
            <h2>Publish Cube</h2>
            <p>Configure publishing options and create your data cube</p>
          </div>
        </div>

        <div class="form-content">
          <!-- Summary Card -->
          <div class="summary-card">
            <h3>Cube Summary</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <label>Name</label>
                <span>{{ cubeName() }}</span>
              </div>
              <div class="summary-item">
                <label>Data Source</label>
                <span>{{ selectedDataSource()?.name }}</span>
              </div>
              <div class="summary-item">
                <label>Dimensions</label>
                <span>{{ mappingStats().dimensions }}</span>
              </div>
              <div class="summary-item">
                <label>Measures</label>
                <span>{{ mappingStats().measures }}</span>
              </div>
              <div class="summary-item">
                <label>License</label>
                <span>{{ getLicenseLabel() }}</span>
              </div>
              <div class="summary-item">
                <label>Publisher</label>
                <span>{{ metadata().publisher || '-' }}</span>
              </div>
            </div>
          </div>

          <p-divider></p-divider>

          <!-- Publish Options -->
          <div class="form-section">
            <h3>Publishing Options</h3>

            <div class="form-row">
              <div class="form-field">
                <label for="triplestore">Destination Triplestore</label>
                <p-select id="triplestore" [options]="triplestoreOptions()" [ngModel]="publishOptions().triplestore"
                         (ngModelChange)="updatePublishTriplestore($event)"
                         optionLabel="label" optionValue="value" placeholder="Select triplestore..." styleClass="w-full"></p-select>
              </div>
              <div class="form-field">
                <label for="graphUri">Target Graph URI</label>
                <input id="graphUri" type="text" pInputText [ngModel]="publishOptions().graphUri"
                       (ngModelChange)="updatePublishGraphUri($event)" class="w-full" />
              </div>
            </div>

            <div class="form-field checkbox-field">
              <p-checkbox [ngModel]="publishOptions().createNamedGraph"
                         (ngModelChange)="updatePublishCreateNamedGraph($event)"
                         [binary]="true" inputId="createGraph"></p-checkbox>
              <label for="createGraph">Create named graph if it doesn't exist</label>
            </div>
          </div>

          <p-divider></p-divider>

          <div class="form-section">
            <h3>Pipeline Options</h3>

            <div class="form-field checkbox-field">
              <p-checkbox [ngModel]="publishOptions().savePipeline"
                         (ngModelChange)="updatePublishSavePipeline($event)"
                         [binary]="true" inputId="savePipeline"></p-checkbox>
              <label for="savePipeline">Save pipeline for future updates</label>
            </div>

            @if (publishOptions().savePipeline) {
              <div class="form-field">
                <label for="pipelineName">Pipeline Name</label>
                <input id="pipelineName" type="text" pInputText [ngModel]="publishOptions().pipelineName"
                       (ngModelChange)="updatePublishPipelineName($event)" class="w-full" />
              </div>
            }

            <div class="form-field checkbox-field">
              <p-checkbox [ngModel]="publishOptions().runImmediately"
                         (ngModelChange)="updatePublishRunImmediately($event)"
                         [binary]="true" inputId="runNow"></p-checkbox>
              <label for="runNow">Run pipeline immediately after creation</label>
            </div>
          </div>

          @if (publishing()) {
            <div class="publish-progress">
              <p-progressBar [value]="publishProgress()" [showValue]="true"></p-progressBar>
              <p>Publishing cube...</p>
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Navigation Footer -->
  <div class="wizard-footer">
    <div class="footer-left">
      @if (activeStep() > 0) {
        <p-button label="Back" icon="pi pi-arrow-left" severity="secondary" (onClick)="prevStep()" [disabled]="publishing()"></p-button>
      }
    </div>
    <div class="footer-right">
      @if (activeStep() < 5) {
        <p-button label="Next" icon="pi pi-arrow-right" iconPos="right" (onClick)="nextStep()"
                 [disabled]="!canProceed(activeStep())"></p-button>
      } @else {
        <p-button label="Publish Cube" icon="pi pi-cloud-upload" (onClick)="publishCube()"
                 [loading]="publishing()" [disabled]="publishing() || !publishOptions().triplestore"></p-button>
      }
    </div>
  </div>
</div>

<!-- New Dimension Dialog -->
<p-dialog header="Create New Dimension" [(visible)]="showNewDimensionDialog" [modal]="true" [style]="{width: '500px'}" [closable]="!savingDimension()">
  <div class="dialog-content">
    <div class="form-field">
      <label for="dimName">Name <span class="required">*</span></label>
      <input id="dimName" type="text" pInputText [ngModel]="newDimension().name"
             (ngModelChange)="updateNewDimensionName($event)" class="w-full" />
    </div>

    <div class="form-field">
      <label for="dimType">Type</label>
      <p-select id="dimType" [options]="dimensionTypes" [ngModel]="newDimension().type"
               (ngModelChange)="updateNewDimensionType($event)"
               optionLabel="label" optionValue="value" styleClass="w-full">
        <ng-template let-item pTemplate="item">
          <div class="dim-type-option">
            <span class="dim-type-label">{{ item.label }}</span>
            <small class="dim-type-desc">{{ item.description }}</small>
          </div>
        </ng-template>
      </p-select>
    </div>

    <div class="form-field">
      <label for="dimUri">URI (optional)</label>
      <input id="dimUri" type="text" pInputText [ngModel]="newDimension().uri"
             (ngModelChange)="updateNewDimensionUri($event)"
             placeholder="Auto-generated if empty" class="w-full" />
    </div>

    <div class="form-field">
      <label for="dimDesc">Description</label>
      <textarea id="dimDesc" pTextarea [ngModel]="newDimension().description"
               (ngModelChange)="updateNewDimensionDescription($event)"
               rows="2" class="w-full"></textarea>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button label="Cancel" icon="pi pi-times" severity="secondary" [text]="true"
             (onClick)="showNewDimensionDialog.set(false)" [disabled]="savingDimension()"></p-button>
    <p-button label="Create" icon="pi pi-check" (onClick)="saveNewDimension()" [loading]="savingDimension()"></p-button>
  </ng-template>
</p-dialog>
