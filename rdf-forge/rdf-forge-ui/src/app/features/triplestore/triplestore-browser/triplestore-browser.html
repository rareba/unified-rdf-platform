<p-toast></p-toast>

<div class="triplestore-browser">
  <div class="header">
    <h1>Triplestore Browser</h1>
    <div class="actions">
      <p-select
        [options]="connections()"
        [ngModel]="selectedConnection()"
        (ngModelChange)="selectConnection($event)"
        optionLabel="name"
        placeholder="Select connection"
        [style]="{ width: '250px' }"></p-select>
      @if (graphs().length > 0) {
        <p-select
          [options]="graphs()"
          [ngModel]="selectedGraph()"
          (ngModelChange)="selectedGraph.set($event)"
          optionLabel="uri"
          placeholder="Select graph (optional)"
          [showClear]="true"
          [style]="{ width: '300px' }"></p-select>
      }
    </div>
  </div>

  @if (selectedConnection()) {
    <div class="grid mt-3">
      <div class="col-12 lg:col-4">
        <p-card header="Graphs">
          @if (graphs().length === 0) {
            <div class="text-muted text-center py-4">No graphs found</div>
          } @else {
            <div class="graph-list">
              @for (graph of graphs(); track graph.uri) {
                <div class="graph-item" [class.selected]="selectedGraph()?.uri === graph.uri" (click)="selectedGraph.set(graph)" (keyup.enter)="selectedGraph.set(graph)" (keyup.space)="selectedGraph.set(graph)" tabindex="0" role="button">
                  <span class="graph-uri">{{ graph.uri }}</span>
                  <span class="graph-count">{{ formatNumber(graph.tripleCount) }} triples</span>
                </div>
              }
            </div>
          }
        </p-card>
      </div>

      <div class="col-12 lg:col-8">
        <p-card header="SPARQL Query">
          <textarea pInputTextarea [ngModel]="sparqlQuery()" (ngModelChange)="sparqlQuery.set($event)" [rows]="6" class="w-full" style="font-family: monospace;"></textarea>
          <div class="mt-3">
            <p-button label="Execute Query" icon="pi pi-play" (click)="executeQuery()" [loading]="queryLoading()"></p-button>
          </div>
        </p-card>

        @if (queryResult()) {
          <p-card header="Results" styleClass="mt-3">
            <div class="result-info mb-3">
              <span>{{ queryResult()!.bindings.length }} results in {{ queryResult()!.executionTime }}ms</span>
            </div>
            <p-table [value]="queryResult()!.bindings" [scrollable]="true" scrollHeight="400px" styleClass="p-datatable-sm">
              <ng-template pTemplate="header">
                <tr>
                  @for (v of queryResult()!.variables; track v) {
                    <th>{{ v }}</th>
                  }
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-row>
                <tr>
                  @for (v of queryResult()!.variables; track v) {
                    <td class="result-cell">{{ row[v]?.value }}</td>
                  }
                </tr>
              </ng-template>
            </p-table>
          </p-card>
        }
      </div>
    </div>
  } @else {
    <div class="empty-state">
      <i class="pi pi-database"></i>
      <p>No triplestore connections configured</p>
    </div>
  }
</div>
