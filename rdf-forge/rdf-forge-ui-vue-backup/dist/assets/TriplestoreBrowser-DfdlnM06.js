import{g as Oe,r as d,d as Be,h as Qe,o as He,a5 as Me,c as w,a as n,b as s,l as A,u as a,s as k,w as m,i as he,F as J,k as Y,C as oe,t as b,L as G,p as z,e as ue,ah as Ae,n as Pe,f as v}from"./index-DFPn2aEF.js";import{a as re,s as me}from"./inputtext.esm-D_f3k6LS.js";import{s as K}from"./tag.esm-DtJLOoeh.js";import{s as ge}from"./panel.esm-BbERc45_.js";import{s as We,a as ie}from"./tabpanel.esm-Ca3TB14W.js";import{s as we}from"./textarea.esm-BYQDUK7K.js";import{s as P,a as R}from"./column.esm-IejHIFmQ.js";import{s as Je}from"./fileupload.esm-CGwGkNkU.js";import{g as L,p as X,a as Ye,d as be}from"./client-D1Swh3D-.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index.esm-mDTaD5AI.js";import"./index.esm-CdlE1liS.js";import"./index.esm-BhZig3PL.js";import"./progressbar.esm-Cw0SY2Ro.js";async function Ke(){return L("/triplestores")}async function Xe(i){return L(`/triplestores/${i}`)}async function Ze(i){return X("/triplestores",i)}async function et(i,f){return Ye(`/triplestores/${i}`,f)}async function tt(i){return be(`/triplestores/${i}`)}async function lt(i){return L(`/triplestores/${i}/health`)}async function nt(i){return X(`/triplestores/${i}/connect`)}async function at(i){return L(`/triplestores/${i}/graphs`)}async function st(i,f,y){return L(`/triplestores/${i}/graphs/${encodeURIComponent(f)}/resources`,y)}async function ot(i,f,y){return L(`/triplestores/${i}/graphs/${encodeURIComponent(f)}/search`,{q:y})}async function ut(i,f,y){return L(`/triplestores/${i}/graphs/${encodeURIComponent(f)}/resources/${encodeURIComponent(y)}`)}async function rt(i,f,y){return X(`/triplestores/${i}/sparql`,{query:f,graph:y})}async function it(i,f,y,$){return X(`/triplestores/${i}/upload`,{graphUri:f,content:y,format:$})}async function ct(i,f){return be(`/triplestores/${i}/graphs/${encodeURIComponent(f)}`)}async function pt(i,f,y){return L(`/triplestores/${i}/graphs/${encodeURIComponent(f)}/export`,{format:y})}const dt=Oe("triplestore",()=>{const i=d([]),f=d(null),y=d([]),$=d(null),_=d(null),U=d(null),c=d(!1),u=d(null);async function N(){c.value=!0,u.value=null;try{return i.value=await Ke(),i.value}catch(o){return u.value=o.message,[]}finally{c.value=!1}}async function E(o){c.value=!0,u.value=null;try{return f.value=await Xe(o),f.value}catch(r){return u.value=r.message,null}finally{c.value=!1}}async function W(o){c.value=!0,u.value=null;try{const r=await Ze(o);return i.value.push(r),r}catch(r){throw u.value=r.message,r}finally{c.value=!1}}async function Z(o,r){var p;c.value=!0,u.value=null;try{const g=await et(o,r),T=i.value.findIndex(le=>le.id===o);return T>=0&&(i.value[T]=g),((p=f.value)==null?void 0:p.id)===o&&(f.value=g),g}catch(g){throw u.value=g.message,g}finally{c.value=!1}}async function x(o){var r;c.value=!0,u.value=null;try{await tt(o),i.value=i.value.filter(p=>p.id!==o),((r=f.value)==null?void 0:r.id)===o&&(f.value=null)}catch(p){throw u.value=p.message,p}finally{c.value=!1}}async function D(o){try{return await lt(o)}catch(r){throw u.value=r.message,r}}async function j(o){c.value=!0,u.value=null;try{await nt(o),await E(o)}catch(r){throw u.value=r.message,r}finally{c.value=!1}}async function F(o){c.value=!0,u.value=null;try{return y.value=await at(o),y.value}catch(r){return u.value=r.message,[]}finally{c.value=!1}}async function V(o,r,p){c.value=!0,u.value=null;try{return await st(o,r,p)}catch(g){return u.value=g.message,[]}finally{c.value=!1}}async function O(o,r,p){c.value=!0,u.value=null;try{return await ot(o,r,p)}catch(g){return u.value=g.message,[]}finally{c.value=!1}}async function q(o,r,p){c.value=!0,u.value=null;try{return _.value=await ut(o,r,p),_.value}catch(g){return u.value=g.message,null}finally{c.value=!1}}async function h(o,r,p){c.value=!0,u.value=null;try{return U.value=await rt(o,r,p),U.value}catch(g){throw u.value=g.message,g}finally{c.value=!1}}async function B(o,r,p,g){c.value=!0,u.value=null;try{const T=await it(o,r,p,g);return await F(o),T}catch(T){throw u.value=T.message,T}finally{c.value=!1}}async function ee(o,r){c.value=!0,u.value=null;try{await ct(o,r),y.value=y.value.filter(p=>p.uri!==r),$.value===r&&($.value=null)}catch(p){throw u.value=p.message,p}finally{c.value=!1}}async function Q(o,r,p){try{return await pt(o,r,p)}catch(g){throw u.value=g.message,g}}function I(o){$.value=o,_.value=null}function te(){_.value=null}return{connections:i,currentConnection:f,graphs:y,currentGraph:$,currentResource:_,lastQueryResult:U,loading:c,error:u,fetchConnections:N,fetchConnection:E,createConnection:W,updateConnection:Z,deleteConnection:x,testConnection:D,connect:j,fetchGraphs:F,fetchGraphResources:V,searchResources:O,fetchResource:q,executeSparql:h,uploadRdf:B,deleteGraph:ee,exportGraph:Q,setCurrentGraph:I,clearCurrentResource:te}}),vt={class:"triplestore-browser"},ft={class:"header"},yt={class:"connection-selector"},ht={class:"browser-content"},mt={class:"sidebar"},gt={class:"graph-list"},wt=["onClick"],bt={class:"graph-info"},Ct={class:"graph-name"},_t={class:"graph-count"},xt={class:"namespace-list"},Rt={class:"ns-prefix"},$t=["title"],kt={class:"main-panel"},St={class:"query-toolbar"},Ut={class:"query-editor"},Et={key:0,class:"query-results"},Tt={class:"results-header"},qt={class:"results-actions"},Gt=["onClick"],Lt={key:1,class:"literal-value"},Vt={key:0,class:"datatype"},Dt={key:2},It={key:1,class:"query-error"},Nt={key:0,class:"graph-browser"},jt={class:"resource-search"},Ft={class:"p-input-icon-left"},Ot={key:0,class:"resource-viewer"},Bt={class:"resource-header"},Qt={class:"resource-types"},Ht={class:"properties-table"},Mt=["onClick"],At=["onClick"],Pt={key:1,class:"literal-value"},Wt={key:0,class:"datatype"},Jt={key:1,class:"lang"},Yt={key:1,class:"resource-list"},zt={class:"uri-value"},Kt={key:1,class:"no-graph-selected"},Xt={class:"upload-section"},Zt={class:"upload-form"},el={class:"field"},tl={class:"field"},ll={class:"field"},nl={class:"upload-method-options"},al={key:1,class:"field"},sl={class:"connections-manager"},ol={class:"query-preview"},ul=Be({__name:"TriplestoreBrowser",setup(i){const f=Me(),y=dt(),$=d([]),_=d(""),U=d("Disconnected"),c=d([]),u=d(null),N=d([]),E=d(`SELECT ?s ?p ?o
WHERE {
  ?s ?p ?o
}
LIMIT 100`),W=d(null),Z=[{name:"Count all triples",query:"SELECT (COUNT(*) as ?count) WHERE { ?s ?p ?o }"},{name:"List types",query:"SELECT DISTINCT ?type (COUNT(?s) as ?count) WHERE { ?s a ?type } GROUP BY ?type ORDER BY DESC(?count)"},{name:"List predicates",query:"SELECT DISTINCT ?p (COUNT(*) as ?count) WHERE { ?s ?p ?o } GROUP BY ?p ORDER BY DESC(?count)"},{name:"Sample data",query:"SELECT ?s ?p ?o WHERE { ?s ?p ?o } LIMIT 100"}],x=d(null),D=d(null),j=d(!1),F=d([]),V=d(""),O=d([]),q=d(null),h=d({graphUri:"",format:"turtle",method:"file",content:"",file:null}),B=d(!1),ee=[{label:"Turtle",value:"turtle"},{label:"RDF/XML",value:"rdfxml"},{label:"N-Triples",value:"ntriples"},{label:"JSON-LD",value:"jsonld"}],Q=d(!1),I=d(!1),te=Qe(()=>h.value.graphUri&&(h.value.file||h.value.content));He(async()=>{await o();const l=f.query.graph;l&&(u.value=l)});async function o(){$.value=await y.fetchConnections(),$.value.length>0&&(_.value=$.value[0].id,await r())}async function r(){try{await y.connect(_.value),U.value="Connected",await p(),g()}catch{U.value="Disconnected"}}async function p(){c.value=await y.fetchGraphs(_.value)}function g(){N.value=[{prefix:"rdf",uri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"},{prefix:"rdfs",uri:"http://www.w3.org/2000/01/rdf-schema#"},{prefix:"xsd",uri:"http://www.w3.org/2001/XMLSchema#"},{prefix:"owl",uri:"http://www.w3.org/2002/07/owl#"},{prefix:"sh",uri:"http://www.w3.org/ns/shacl#"},{prefix:"cube",uri:"https://cube.link/"}]}async function T(l){u.value=l,q.value=null,await le()}async function le(){u.value&&(O.value=await y.fetchGraphResources(_.value,u.value))}function Ce(l){l.value&&(E.value=l.value.query)}async function ce(){j.value=!0,D.value=null,x.value=null;try{const l=await y.executeSparql(_.value,E.value,u.value);x.value=l,F.value.unshift({query:E.value,executedAt:new Date})}catch(l){D.value=l.message}finally{j.value=!1}}function _e(){console.log("Save query")}function xe(l){E.value=l,I.value=!1,ce()}function pe(l){if(!x.value)return;let t,S,e;if(l==="csv"){const je=x.value.variables.join(","),Fe=x.value.bindings.map(ve=>x.value.variables.map(fe=>{var ye;return JSON.stringify(((ye=ve[fe])==null?void 0:ye.value)||ve[fe]||"")}).join(","));t=[je,...Fe].join(`
`),S="text/csv",e="query-results.csv"}else t=JSON.stringify(x.value.bindings,null,2),S="application/json",e="query-results.json";const C=new Blob([t],{type:S}),de=URL.createObjectURL(C),se=document.createElement("a");se.href=de,se.download=e,se.click()}async function ne(){V.value&&(O.value=await y.searchResources(_.value,u.value,V.value))}function Re(l){q.value=l.data}function ae(l){V.value=l,ne()}function $e(l){h.value.file=l.files[0]}async function ke(){B.value=!0;try{const l=h.value.method==="file"&&h.value.file?await h.value.file.text():h.value.content;await y.uploadRdf(_.value,h.value.graphUri,l,h.value.format),await p(),h.value={graphUri:"",format:"turtle",method:"file",content:"",file:null}}finally{B.value=!1}}function Se(){console.log("Add connection")}function Ue(l){console.log("Edit connection",l)}function Ee(l){console.log("Delete connection",l)}function Te(l){const t=l.split("/");return t[t.length-1]||l}function H(l){const t=l.lastIndexOf("#"),S=l.lastIndexOf("/"),e=Math.max(t,S);return e>=0?l.substring(e+1):l}function M(l){for(const t of N.value)if(l.startsWith(t.uri))return`${t.prefix}:${l.substring(t.uri.length)}`;return H(l)}function qe(l){return l.length>40?l.substring(0,40)+"...":l}function Ge(l){return l.length>30?l.substring(0,30)+"...":l}function Le(l){return l.length>80?l.substring(0,80)+"...":l}function Ve(l){return l&&typeof l=="object"&&l.type==="uri"}function De(l){return l&&typeof l=="object"&&l.type==="literal"}function Ie(l){return l.toLocaleString()}function Ne(l){return new Date(l).toLocaleString()}return(l,t)=>{const S=Pe("tooltip");return v(),w("div",vt,[n("div",ft,[t[15]||(t[15]=n("h1",null,"Triplestore Browser",-1)),n("div",yt,[s(a(re),{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),options:$.value,optionLabel:"name",optionValue:"id",placeholder:"Select connection",class:"connection-dropdown"},null,8,["modelValue","options"]),s(a(K),{value:U.value,severity:U.value==="Connected"?"success":"danger",icon:U.value==="Connected"?"pi pi-check-circle":"pi pi-times-circle"},null,8,["value","severity","icon"]),A(s(a(k),{icon:"pi pi-cog",class:"p-button-text",onClick:t[1]||(t[1]=e=>Q.value=!0)},null,512),[[S,"Manage connections"]])])]),n("div",ht,[n("div",mt,[s(a(ge),{header:"Graphs"},{default:m(()=>[n("div",gt,[(v(!0),w(J,null,Y(c.value,e=>(v(),w("div",{key:e.uri,class:oe(["graph-item",{selected:u.value===e.uri}]),onClick:C=>T(e.uri)},[t[16]||(t[16]=n("i",{class:"pi pi-folder"},null,-1)),n("div",bt,[n("span",Ct,b(Te(e.uri)),1),n("span",_t,b(Ie(e.tripleCount))+" triples",1)])],10,wt))),128))])]),_:1}),s(a(ge),{header:"Namespaces",toggleable:!0,collapsed:!0},{default:m(()=>[n("div",xt,[(v(!0),w(J,null,Y(N.value,e=>(v(),w("div",{key:e.prefix,class:"namespace-item"},[n("code",Rt,b(e.prefix)+":",1),n("span",{class:"ns-uri",title:e.uri},b(qe(e.uri)),9,$t)]))),128))])]),_:1})]),n("div",kt,[s(a(We),null,{default:m(()=>[s(a(ie),{header:"SPARQL Query"},{default:m(()=>[n("div",St,[s(a(re),{modelValue:W.value,"onUpdate:modelValue":t[2]||(t[2]=e=>W.value=e),options:Z,optionLabel:"name",placeholder:"Query templates",onChange:Ce,class:"template-dropdown"},null,8,["modelValue"]),t[17]||(t[17]=n("div",{class:"spacer"},null,-1)),s(a(k),{label:"Execute",icon:"pi pi-play",onClick:ce,loading:j.value},null,8,["loading"]),A(s(a(k),{icon:"pi pi-save",class:"p-button-text",onClick:_e},null,512),[[S,"Save query"]]),A(s(a(k),{icon:"pi pi-history",class:"p-button-text",onClick:t[3]||(t[3]=e=>I.value=!0)},null,512),[[S,"History"]])]),n("div",Ut,[s(a(we),{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=e=>E.value=e),rows:10,placeholder:"Enter SPARQL query...",class:"w-full code-textarea"},null,8,["modelValue"])]),x.value?(v(),w("div",Et,[n("div",Tt,[n("span",null,b(x.value.bindings.length)+" results ("+b(x.value.executionTime)+"ms)",1),n("div",qt,[A(s(a(k),{icon:"pi pi-download",class:"p-button-text",onClick:t[5]||(t[5]=e=>pe("csv"))},null,512),[[S,"Export CSV"]]),A(s(a(k),{icon:"pi pi-code",class:"p-button-text",onClick:t[6]||(t[6]=e=>pe("json"))},null,512),[[S,"Export JSON"]])])]),s(a(P),{value:x.value.bindings,rows:20,paginator:x.value.bindings.length>20,class:"p-datatable-sm",responsiveLayout:"scroll"},{default:m(()=>[(v(!0),w(J,null,Y(x.value.variables,e=>(v(),z(a(R),{key:e,field:e,header:e},{body:m(({data:C})=>[Ve(C[e])?(v(),w("span",{key:0,class:"uri-value",onClick:de=>ae(C[e])},b(M(C[e])),9,Gt)):De(C[e])?(v(),w("span",Lt,[ue(' "'+b(C[e].value)+'" ',1),C[e].datatype?(v(),w("sup",Vt,b(H(C[e].datatype)),1)):G("",!0)])):(v(),w("span",Dt,b(C[e]),1))]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","paginator"])])):G("",!0),D.value?(v(),w("div",It,[t[18]||(t[18]=n("i",{class:"pi pi-times-circle"},null,-1)),n("span",null,b(D.value),1)])):G("",!0)]),_:1}),s(a(ie),{header:"Graph Browser"},{default:m(()=>[u.value?(v(),w("div",Nt,[n("div",jt,[n("span",Ft,[t[19]||(t[19]=n("i",{class:"pi pi-search"},null,-1)),s(a(me),{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=e=>V.value=e),placeholder:"Search resources...",onKeyup:Ae(ne,["enter"])},null,8,["modelValue"])]),s(a(k),{label:"Search",onClick:ne})]),q.value?(v(),w("div",Ot,[n("div",Bt,[n("h3",null,b(M(q.value.uri)),1),n("div",Qt,[(v(!0),w(J,null,Y(q.value.types,e=>(v(),z(a(K),{key:e,value:H(e)},null,8,["value"]))),128))])]),n("div",Ht,[s(a(P),{value:q.value.properties,class:"p-datatable-sm"},{default:m(()=>[s(a(R),{field:"predicate",header:"Property",style:{width:"200px"}},{body:m(({data:e})=>[n("span",{class:"predicate",onClick:C=>ae(e.predicate)},b(M(e.predicate)),9,Mt)]),_:1}),s(a(R),{field:"object",header:"Value"},{body:m(({data:e})=>[e.objectType==="uri"?(v(),w("span",{key:0,class:"uri-value",onClick:C=>ae(e.object)},b(M(e.object)),9,At)):(v(),w("span",Pt,[ue(' "'+b(e.object)+'" ',1),e.datatype?(v(),w("sup",Wt,b(H(e.datatype)),1)):G("",!0),e.language?(v(),w("sup",Jt,"@"+b(e.language),1)):G("",!0)]))]),_:1})]),_:1},8,["value"])])])):(v(),w("div",Yt,[s(a(P),{value:O.value,rows:20,paginator:!0,class:"p-datatable-sm",onRowClick:Re},{default:m(()=>[s(a(R),{field:"uri",header:"Subject"},{body:m(({data:e})=>[n("span",zt,b(M(e.uri)),1)]),_:1}),s(a(R),{field:"type",header:"Type"},{body:m(({data:e})=>[e.type?(v(),z(a(K),{key:0,value:H(e.type)},null,8,["value"])):G("",!0)]),_:1}),s(a(R),{field:"label",header:"Label"})]),_:1},8,["value"])]))])):(v(),w("div",Kt,[...t[20]||(t[20]=[n("i",{class:"pi pi-folder-open",style:{"font-size":"3rem",color:"var(--text-color-secondary)"}},null,-1),n("p",null,"Select a graph from the sidebar to browse its contents",-1)])]))]),_:1}),s(a(ie),{header:"Upload"},{default:m(()=>[n("div",Xt,[t[27]||(t[27]=n("h3",null,"Upload RDF Data",-1)),t[28]||(t[28]=n("p",{class:"upload-description"},"Upload RDF data to a named graph in the triplestore.",-1)),n("div",Zt,[n("div",el,[t[21]||(t[21]=n("label",{for:"targetGraph"},"Target Graph URI",-1)),s(a(me),{id:"targetGraph",modelValue:h.value.graphUri,"onUpdate:modelValue":t[8]||(t[8]=e=>h.value.graphUri=e),class:"w-full",placeholder:"http://example.org/graph/my-data"},null,8,["modelValue"])]),n("div",tl,[t[22]||(t[22]=n("label",null,"RDF Format",-1)),s(a(re),{modelValue:h.value.format,"onUpdate:modelValue":t[9]||(t[9]=e=>h.value.format=e),options:ee,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),n("div",ll,[t[25]||(t[25]=n("label",null,"Upload Method",-1)),n("div",nl,[n("div",{class:oe(["method-option",{selected:h.value.method==="file"}]),onClick:t[10]||(t[10]=e=>h.value.method="file")},[...t[23]||(t[23]=[n("i",{class:"pi pi-upload"},null,-1),n("span",null,"File Upload",-1)])],2),n("div",{class:oe(["method-option",{selected:h.value.method==="paste"}]),onClick:t[11]||(t[11]=e=>h.value.method="paste")},[...t[24]||(t[24]=[n("i",{class:"pi pi-file-edit"},null,-1),n("span",null,"Paste Content",-1)])],2)])]),h.value.method==="file"?(v(),z(a(Je),{key:0,mode:"basic",accept:".ttl,.rdf,.nt,.nq,.jsonld,.json",maxFileSize:1e8,onSelect:$e,chooseLabel:"Select RDF File"})):G("",!0),h.value.method==="paste"?(v(),w("div",al,[t[26]||(t[26]=n("label",null,"RDF Content",-1)),s(a(we),{modelValue:h.value.content,"onUpdate:modelValue":t[12]||(t[12]=e=>h.value.content=e),rows:15,class:"w-full code-textarea",placeholder:"Paste RDF content here..."},null,8,["modelValue"])])):G("",!0),s(a(k),{label:"Upload to Graph",icon:"pi pi-cloud-upload",onClick:ke,loading:B.value,disabled:!te.value},null,8,["loading","disabled"])])])]),_:1})]),_:1})])]),s(a(he),{visible:Q.value,"onUpdate:visible":t[13]||(t[13]=e=>Q.value=e),header:"Manage Connections",style:{width:"600px"},modal:!0},{default:m(()=>[n("div",sl,[s(a(P),{value:$.value,class:"p-datatable-sm"},{default:m(()=>[s(a(R),{field:"name",header:"Name"}),s(a(R),{field:"type",header:"Type"},{body:m(({data:e})=>[s(a(K),{value:e.type},null,8,["value"])]),_:1}),s(a(R),{field:"url",header:"URL"},{body:m(({data:e})=>[n("code",null,b(Ge(e.url)),1)]),_:1}),s(a(R),{style:{width:"100px"}},{body:m(({data:e})=>[s(a(k),{icon:"pi pi-pencil",class:"p-button-rounded p-button-text",onClick:C=>Ue(e)},null,8,["onClick"]),s(a(k),{icon:"pi pi-trash",class:"p-button-rounded p-button-danger p-button-text",onClick:C=>Ee(e)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),s(a(k),{label:"Add Connection",icon:"pi pi-plus",class:"p-button-outlined mt-3",onClick:Se})])]),_:1},8,["visible"]),s(a(he),{visible:I.value,"onUpdate:visible":t[14]||(t[14]=e=>I.value=e),header:"Query History",style:{width:"700px"},modal:!0},{default:m(()=>[s(a(P),{value:F.value,rows:10,paginator:!0,class:"p-datatable-sm"},{default:m(()=>[s(a(R),{field:"query",header:"Query"},{body:m(({data:e})=>[n("code",ol,b(Le(e.query)),1)]),_:1}),s(a(R),{field:"executedAt",header:"Executed",style:{width:"150px"}},{body:m(({data:e})=>[ue(b(Ne(e.executedAt)),1)]),_:1}),s(a(R),{style:{width:"80px"}},{body:m(({data:e})=>[s(a(k),{icon:"pi pi-replay",class:"p-button-rounded p-button-text",onClick:C=>xe(e.query)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1},8,["visible"])])}}}),_l=ze(ul,[["__scopeId","data-v-11d748f9"]]);export{_l as default};
