import{a2 as Ce,aa as Ve,a3 as Ie,ai as Z,n as ae,c as d,f as u,a as e,l as le,Y as x,z as Pe,L as p,C as U,t as i,d as $e,h as L,a5 as Be,r as C,o as Te,y as xe,v as Oe,b as c,u as r,s as V,p as F,w as b,j as De,F as ee,k as te,J as je}from"./index-DFPn2aEF.js";import{s as A}from"./tag.esm-DtJLOoeh.js";import{s as Je}from"./progressbar.esm-Cw0SY2Ro.js";import{s as Ne,a as O}from"./tabpanel.esm-Ca3TB14W.js";import{s as se}from"./panel.esm-BbERc45_.js";import{a as Fe,s as Ue}from"./inputtext.esm-D_f3k6LS.js";import{s as Ge,a as q}from"./column.esm-IejHIFmQ.js";import{u as Me}from"./job-363zI-rv.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index.esm-CdlE1liS.js";import"./index.esm-BhZig3PL.js";import"./index.esm-mDTaD5AI.js";import"./client-D1Swh3D-.js";var Ae={root:function(o){var v=o.instance,g=o.props;return["p-togglebutton p-component",{"p-disabled":g.disabled,"p-highlight":v.active,"p-invalid":g.invalid}]},input:"p-togglebutton-input",box:function(o){var v=o.instance;return["p-button p-component",{"p-button-icon-only":v.hasIcon&&!v.hasLabel}]},icon:function(o){var v=o.instance,g=o.props;return["p-button-icon",{"p-button-icon-left":g.iconPos==="left"&&v.label,"p-button-icon-right":g.iconPos==="right"&&v.label}]},label:"p-button-label"},qe=Ce.extend({name:"togglebutton",classes:Ae}),Ee={name:"BaseToggleButton",extends:Ie,props:{modelValue:Boolean,onIcon:String,offIcon:String,onLabel:{type:String,default:"Yes"},offLabel:{type:String,default:"No"},iconPos:{type:String,default:"left"},invalid:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},tabindex:{type:Number,default:null},inputId:{type:String,default:null},inputClass:{type:[String,Object],default:null},inputStyle:{type:Object,default:null},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:qe,provide:function(){return{$parentInstance:this}}},ne={name:"ToggleButton",extends:Ee,inheritAttrs:!1,emits:["update:modelValue","change","focus","blur"],methods:{getPTOptions:function(o){var v=o==="root"?this.ptmi:this.ptm;return v(o,{context:{active:this.active,disabled:this.disabled}})},onChange:function(o){!this.disabled&&!this.readonly&&(this.$emit("update:modelValue",!this.modelValue),this.$emit("change",o))},onFocus:function(o){this.$emit("focus",o)},onBlur:function(o){this.$emit("blur",o)}},computed:{active:function(){return this.modelValue===!0},hasLabel:function(){return Z.isNotEmpty(this.onLabel)&&Z.isNotEmpty(this.offLabel)},hasIcon:function(){return this.$slots.icon||this.onIcon&&this.offIcon},label:function(){return this.hasLabel?this.modelValue?this.onLabel:this.offLabel:"&nbsp;"}},directives:{ripple:Ve}},We=["data-p-highlight","data-p-disabled"],ze=["id","value","checked","tabindex","disabled","readonly","aria-labelledby","aria-label","aria-invalid"];function Ye(n,o,v,g,h,a){var w=ae("ripple");return u(),d("div",x({class:n.cx("root")},a.getPTOptions("root"),{"data-p-highlight":a.active,"data-p-disabled":n.disabled}),[e("input",x({id:n.inputId,type:"checkbox",role:"switch",class:[n.cx("input"),n.inputClass],style:n.inputStyle,value:n.modelValue,checked:a.active,tabindex:n.tabindex,disabled:n.disabled,readonly:n.readonly,"aria-labelledby":n.ariaLabelledby,"aria-label":n.ariaLabel,"aria-invalid":n.invalid||void 0,onFocus:o[0]||(o[0]=function(){return a.onFocus&&a.onFocus.apply(a,arguments)}),onBlur:o[1]||(o[1]=function(){return a.onBlur&&a.onBlur.apply(a,arguments)}),onChange:o[2]||(o[2]=function(){return a.onChange&&a.onChange.apply(a,arguments)})},a.getPTOptions("input")),null,16,ze),le((u(),d("div",x({class:n.cx("box")},a.getPTOptions("box")),[Pe(n.$slots,"icon",{value:n.modelValue,class:U(n.cx("icon"))},function(){return[n.onIcon||n.offIcon?(u(),d("span",x({key:0,class:[n.cx("icon"),n.modelValue?n.onIcon:n.offIcon]},a.getPTOptions("icon")),null,16)):p("",!0)]}),e("span",x({class:n.cx("label")},a.getPTOptions("label")),i(a.label),17)],16)),[[w]])],16,We)}ne.render=Ye;const He={class:"job-monitor"},Ke={class:"header"},Qe={class:"header-left"},Xe={class:"job-title"},Ze={class:"header-actions"},et={class:"monitor-content"},tt={class:"main-panel"},st={key:0,class:"progress-section"},at={class:"progress-header"},lt={class:"progress-details"},nt={class:"logs-toolbar"},it={class:"p-input-icon-left"},ot={class:"log-timestamp"},rt={class:"log-level"},ut={key:0,class:"log-step"},ct={class:"log-message"},dt={key:0,class:"logs-empty"},pt={class:"steps-timeline"},vt={key:0,class:"step-connector"},ft={class:"step-icon"},mt={class:"step-content"},bt={class:"step-header"},gt={class:"step-name"},ht={key:0,class:"step-duration"},yt={key:0,class:"step-details"},_t={key:0},wt={key:1,class:"step-error"},kt={class:"metrics-grid"},St={class:"metric-card"},Lt={class:"metric-content"},Ct={class:"metric-value"},Vt={class:"metric-card"},It={class:"metric-content"},Pt={class:"metric-value"},$t={class:"metric-card"},Bt={class:"metric-content"},Tt={class:"metric-value"},xt={class:"metric-card"},Ot={class:"metric-content"},Dt={class:"metric-value"},jt={key:0},Jt={key:1},Nt={class:"error-section"},Ft={class:"error-message"},Ut={key:0,class:"error-details"},Gt={key:1,class:"error-context"},Mt={class:"side-panel"},Rt={class:"detail-item"},At={class:"value"},qt={class:"detail-item"},Et={class:"detail-item"},Wt={class:"value"},zt={class:"detail-item"},Yt={class:"detail-item"},Ht={class:"value"},Kt={class:"detail-item"},Qt={class:"value"},Xt={class:"detail-item"},Zt={class:"value"},es={class:"output-item"},ts={class:"output-info"},ss={class:"output-uri"},as=$e({__name:"JobMonitor",setup(n){const o=Be(),v=De(),g=Me(),h=L(()=>o.params.id),a=C(null),w=C([]),k=C([]),D=C(null),j=C("info"),J=C(""),G=C(!0);let M,I=null;const ie=[{label:"All",value:"all"},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warning",value:"warn"},{label:"Error",value:"error"}],oe=L(()=>k.value.findIndex(s=>s.status==="running")+1||k.value.filter(s=>s.status==="completed").length),re=L(()=>k.value.length),ue=L(()=>{var s;return((s=k.value.find(t=>t.status==="running"))==null?void 0:s.name)||"-"}),ce=L(()=>{let s=w.value;if(j.value!=="all"){const t=["debug","info","warn","error"],f=t.indexOf(j.value);s=s.filter(m=>t.indexOf(m.level)>=f)}if(J.value){const t=J.value.toLowerCase();s=s.filter(f=>f.message.toLowerCase().includes(t))}return s}),de=L(()=>{var t,f,m;if(!((f=(t=a.value)==null?void 0:t.metrics)!=null&&f.rowsProcessed)||!((m=a.value)!=null&&m.duration))return"-";const s=(a.value.metrics.rowsProcessed/(a.value.duration/1e3)).toFixed(0);return`${P(Number(s))} rows/s`}),pe=L(()=>{var s;return(s=a.value)!=null&&s.variables?Object.entries(a.value.variables).map(([t,f])=>({name:t,value:f,sensitive:t.toLowerCase().includes("password")||t.toLowerCase().includes("secret"),source:"runtime"})):[]});Te(async()=>{await N(),ve(),M=window.setInterval(N,3e3)}),xe(()=>{M&&clearInterval(M),I&&I.close()}),Oe(w,()=>{G.value&&je(()=>{D.value&&(D.value.scrollTop=D.value.scrollHeight)})});async function N(){var s;a.value=await g.fetchJob(h.value),k.value=((s=a.value)==null?void 0:s.steps)||[]}function ve(){const s=`ws://localhost:8003/api/v1/jobs/${h.value}/logs/stream`;I=new WebSocket(s),I.onmessage=t=>{const f=JSON.parse(t.data);w.value.push(f)},I.onerror=()=>{console.error("WebSocket error")}}function fe(){v.push("/jobs")}async function me(){await g.cancelJob(h.value),await N()}async function be(){await g.retryJob(h.value),await N()}function E(){var s;(s=a.value)!=null&&s.pipelineId&&v.push(`/pipelines/${a.value.pipelineId}`)}function ge(){var s;(s=a.value)!=null&&s.outputGraph&&v.push({path:"/triplestore",query:{graph:a.value.outputGraph}})}function he(){const s=w.value.map(y=>`${y.timestamp} [${y.level.toUpperCase()}] ${y.step?`[${y.step}] `:""}${y.message}`).join(`
`),t=new Blob([s],{type:"text/plain"}),f=URL.createObjectURL(t),m=document.createElement("a");m.href=f,m.download=`job-${h.value}-logs.txt`,m.click()}function ye(s){switch(s){case"running":return"info";case"completed":return"success";case"failed":return"danger";case"cancelled":return"warning";default:return"secondary"}}function _e(s){switch(s){case"running":return"pi pi-spin pi-spinner";case"completed":return"pi pi-check";case"failed":return"pi pi-times";case"cancelled":return"pi pi-ban";default:return"pi pi-clock"}}function we(s){switch(s){case"running":return"pi pi-spin pi-spinner";case"completed":return"pi pi-check";case"failed":return"pi pi-times";case"skipped":return"pi pi-minus";default:return"pi pi-circle"}}function ke(s){switch(s){case"manual":return"info";case"schedule":return"success";case"api":return"warning";default:return"secondary"}}function Se(s){switch(s){case"environment":return"info";case"runtime":return"success";case"default":return"secondary";default:return"info"}}function R(s){return s?new Date(s).toLocaleString():""}function Le(s){return new Date(s).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}function W(s){return s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:s<36e5?`${Math.round(s/6e4)}m`:`${Math.round(s/36e5)}h`}function P(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}return(s,t)=>{var m,y,z,Y,H,K,Q;const f=ae("tooltip");return u(),d("div",He,[e("div",Ke,[e("div",Qe,[c(r(V),{icon:"pi pi-arrow-left",class:"p-button-text",onClick:fe}),e("div",Xe,[e("h1",null,"Job "+i(h.value.substring(0,8)),1),c(r(A),{value:(m=a.value)==null?void 0:m.status,severity:ye((y=a.value)==null?void 0:y.status),icon:_e((z=a.value)==null?void 0:z.status)},null,8,["value","severity","icon"])])]),e("div",Ze,[((Y=a.value)==null?void 0:Y.status)==="running"?(u(),F(r(V),{key:0,label:"Cancel",icon:"pi pi-stop",class:"p-button-danger",onClick:me})):p("",!0),((H=a.value)==null?void 0:H.status)==="failed"?(u(),F(r(V),{key:1,label:"Retry",icon:"pi pi-refresh",onClick:be})):p("",!0),c(r(V),{label:"View Pipeline",icon:"pi pi-sitemap",class:"p-button-outlined",onClick:E})])]),e("div",et,[e("div",tt,[((K=a.value)==null?void 0:K.status)==="running"?(u(),d("div",st,[e("div",at,[t[3]||(t[3]=e("span",null,"Progress",-1)),e("span",null,i(a.value.progress)+"%",1)]),c(r(Je),{value:a.value.progress,style:{height:"12px"}},null,8,["value"]),e("div",lt,[e("span",null,"Step "+i(oe.value)+" of "+i(re.value),1),e("span",null,i(ue.value),1)])])):p("",!0),c(r(Ne),null,{default:b(()=>{var _;return[c(r(O),{header:"Logs"},{default:b(()=>[e("div",nt,[c(r(Fe),{modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=l=>j.value=l),options:ie,optionLabel:"label",optionValue:"value",placeholder:"Log Level"},null,8,["modelValue"]),e("span",it,[t[4]||(t[4]=e("i",{class:"pi pi-search"},null,-1)),c(r(Ue),{modelValue:J.value,"onUpdate:modelValue":t[1]||(t[1]=l=>J.value=l),placeholder:"Search logs..."},null,8,["modelValue"])]),t[5]||(t[5]=e("div",{class:"spacer"},null,-1)),c(r(ne),{modelValue:G.value,"onUpdate:modelValue":t[2]||(t[2]=l=>G.value=l),onLabel:"Auto-scroll",offLabel:"Auto-scroll",onIcon:"pi pi-check",offIcon:"pi pi-times"},null,8,["modelValue"]),le(c(r(V),{icon:"pi pi-download",class:"p-button-text",onClick:he},null,512),[[f,"Download logs"]])]),e("div",{class:"logs-container",ref_key:"logsContainer",ref:D},[(u(!0),d(ee,null,te(ce.value,l=>(u(),d("div",{key:l.id,class:U(["log-entry",`log-${l.level}`])},[e("span",ot,i(Le(l.timestamp)),1),e("span",rt,i(l.level.toUpperCase()),1),l.step?(u(),d("span",ut,"["+i(l.step)+"]",1)):p("",!0),e("span",ct,i(l.message),1)],2))),128)),w.value.length===0?(u(),d("div",dt,[...t[6]||(t[6]=[e("i",{class:"pi pi-file"},null,-1),e("span",null,"No logs available yet",-1)])])):p("",!0)],512)]),_:1}),c(r(O),{header:"Pipeline Steps"},{default:b(()=>[e("div",pt,[(u(!0),d(ee,null,te(k.value,(l,S)=>(u(),d("div",{key:l.id,class:U(["step-item",l.status])},[S<k.value.length-1?(u(),d("div",vt)):p("",!0),e("div",ft,[e("i",{class:U(we(l.status))},null,2)]),e("div",mt,[e("div",bt,[e("span",gt,i(l.name),1),l.duration?(u(),d("span",ht,i(W(l.duration)),1)):p("",!0)]),l.metrics?(u(),d("div",yt,[e("span",null,i(P(l.metrics.rowsProcessed))+" rows processed",1),l.metrics.quadsGenerated?(u(),d("span",_t,i(P(l.metrics.quadsGenerated))+" quads generated",1)):p("",!0)])):p("",!0),l.error?(u(),d("div",wt,i(l.error),1)):p("",!0)])],2))),128))])]),_:1}),c(r(O),{header:"Metrics"},{default:b(()=>{var l,S,$,B,T;return[e("div",kt,[e("div",St,[t[8]||(t[8]=e("div",{class:"metric-icon"},[e("i",{class:"pi pi-database"})],-1)),e("div",Lt,[e("span",Ct,i(P(((S=(l=a.value)==null?void 0:l.metrics)==null?void 0:S.rowsProcessed)||0)),1),t[7]||(t[7]=e("span",{class:"metric-label"},"Rows Processed",-1))])]),e("div",Vt,[t[10]||(t[10]=e("div",{class:"metric-icon"},[e("i",{class:"pi pi-share-alt"})],-1)),e("div",It,[e("span",Pt,i(P(((B=($=a.value)==null?void 0:$.metrics)==null?void 0:B.quadsGenerated)||0)),1),t[9]||(t[9]=e("span",{class:"metric-label"},"Quads Generated",-1))])]),e("div",$t,[t[12]||(t[12]=e("div",{class:"metric-icon"},[e("i",{class:"pi pi-clock"})],-1)),e("div",Bt,[e("span",Tt,i((T=a.value)!=null&&T.duration?W(a.value.duration):"-"),1),t[11]||(t[11]=e("span",{class:"metric-label"},"Duration",-1))])]),e("div",xt,[t[14]||(t[14]=e("div",{class:"metric-icon"},[e("i",{class:"pi pi-bolt"})],-1)),e("div",Ot,[e("span",Dt,i(de.value),1),t[13]||(t[13]=e("span",{class:"metric-label"},"Throughput",-1))])])]),t[15]||(t[15]=e("div",{class:"charts-section"},[e("h3",null,"Processing Rate"),e("div",{class:"chart-placeholder"},[e("p",null,"Processing rate chart")])],-1))]}),_:1}),c(r(O),{header:"Variables"},{default:b(()=>[c(r(Ge),{value:pe.value,class:"p-datatable-sm"},{default:b(()=>[c(r(q),{field:"name",header:"Variable"}),c(r(q),{field:"value",header:"Value"},{body:b(({data:l})=>[l.sensitive?(u(),d("code",jt,"********")):(u(),d("code",Jt,i(l.value),1))]),_:1}),c(r(q),{field:"source",header:"Source"},{body:b(({data:l})=>[c(r(A),{value:l.source,severity:Se(l.source)},null,8,["value","severity"])]),_:1})]),_:1},8,["value"])]),_:1}),((_=a.value)==null?void 0:_.status)==="failed"?(u(),F(r(O),{key:0,header:"Error"},{default:b(()=>{var l;return[e("div",Nt,[t[18]||(t[18]=e("div",{class:"error-header"},[e("i",{class:"pi pi-times-circle"}),e("span",null,"Job Failed")],-1)),e("div",Ft,i(a.value.errorMessage),1),a.value.errorDetails?(u(),d("div",Ut,[t[16]||(t[16]=e("h4",null,"Stack Trace",-1)),e("pre",null,i(a.value.errorDetails.stackTrace),1)])):p("",!0),(l=a.value.errorDetails)!=null&&l.context?(u(),d("div",Gt,[t[17]||(t[17]=e("h4",null,"Context",-1)),e("pre",null,i(JSON.stringify(a.value.errorDetails.context,null,2)),1)])):p("",!0)])]}),_:1})):p("",!0)]}),_:1})]),e("div",Mt,[c(r(se),{header:"Job Details"},{default:b(()=>{var _,l,S,$,B,T,X;return[e("div",Rt,[t[19]||(t[19]=e("span",{class:"label"},"Job ID",-1)),e("code",At,i(h.value),1)]),e("div",qt,[t[20]||(t[20]=e("span",{class:"label"},"Pipeline",-1)),e("span",{class:"value link",onClick:E},i((_=a.value)==null?void 0:_.pipelineName),1)]),e("div",Et,[t[21]||(t[21]=e("span",{class:"label"},"Version",-1)),e("span",Wt,"v"+i((l=a.value)==null?void 0:l.pipelineVersion),1)]),e("div",zt,[t[22]||(t[22]=e("span",{class:"label"},"Triggered By",-1)),c(r(A),{value:(S=a.value)==null?void 0:S.triggeredBy,severity:ke(($=a.value)==null?void 0:$.triggeredBy)},null,8,["value","severity"])]),e("div",Yt,[t[23]||(t[23]=e("span",{class:"label"},"Created",-1)),e("span",Ht,i(R((B=a.value)==null?void 0:B.createdAt)),1)]),e("div",Kt,[t[24]||(t[24]=e("span",{class:"label"},"Started",-1)),e("span",Qt,i(R((T=a.value)==null?void 0:T.startedAt)||"Pending"),1)]),e("div",Xt,[t[25]||(t[25]=e("span",{class:"label"},"Completed",-1)),e("span",Zt,i(R((X=a.value)==null?void 0:X.completedAt)||"-"),1)])]}),_:1}),((Q=a.value)==null?void 0:Q.status)==="completed"?(u(),F(r(se),{key:0,header:"Output"},{default:b(()=>{var _;return[e("div",es,[t[27]||(t[27]=e("i",{class:"pi pi-database"},null,-1)),e("div",ts,[t[26]||(t[26]=e("span",{class:"output-name"},"Target Graph",-1)),e("code",ss,i((_=a.value)==null?void 0:_.outputGraph),1)]),c(r(V),{icon:"pi pi-external-link",class:"p-button-text p-button-sm",onClick:ge})])]}),_:1})):p("",!0)])])])}}}),gs=Re(as,[["__scopeId","data-v-c3a3cf59"]]);export{gs as default};
