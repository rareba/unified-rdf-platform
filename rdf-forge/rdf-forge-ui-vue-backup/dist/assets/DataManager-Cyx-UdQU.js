import{g as ie,r as v,d as re,h as de,o as ce,c as g,a,L as N,b as o,u as n,s as k,F as M,k as O,w as m,i as P,C as G,t as p,e as x,l as j,m as T,p as pe,n as ve,f as S}from"./index-DFPn2aEF.js";import{s as fe,a as K}from"./inputtext.esm-D_f3k6LS.js";import{s as Q}from"./tag.esm-DtJLOoeh.js";import{s as me}from"./fileupload.esm-CGwGkNkU.js";import{b as ye,s as W,a as U}from"./column.esm-IejHIFmQ.js";import{s as we,a as A}from"./tabpanel.esm-Ca3TB14W.js";import{g as I,u as Se,d as De,p as ge}from"./client-D1Swh3D-.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index.esm-mDTaD5AI.js";import"./progressbar.esm-Cw0SY2Ro.js";import"./index.esm-BhZig3PL.js";import"./index.esm-CdlE1liS.js";async function he(s){return I("/data",s)}async function xe(s){return I(`/data/${s}`)}async function Ce(s,u){return Se("/data/upload",s,u)}async function $e(s){return De(`/data/${s}`)}async function ke(s,u){return I(`/data/${s}/preview`,u)}async function Ue(s){var b;const u=await fetch(`/api/v1/data/${s}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}}),w=await u.blob(),i=URL.createObjectURL(w),r=document.createElement("a");r.href=i,r.download=(((b=u.headers.get("Content-Disposition"))==null?void 0:b.match(/filename="(.+)"/))||[])[1]||"download",r.click(),URL.revokeObjectURL(i)}async function Fe(s){return ge(`/data/${s}/analyze`)}async function ze(s){const u=new FormData;return u.append("file",s.slice(0,1e4)),(await fetch("/api/v1/data/detect-format",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:u})).json()}const Ve=ie("data",()=>{const s=v([]),u=v(null),w=v(null),i=v(!1),r=v(null);async function b(d){i.value=!0,r.value=null;try{return s.value=await he(d),s.value}catch(c){return r.value=c.message,[]}finally{i.value=!1}}async function F(d){i.value=!0,r.value=null;try{return u.value=await xe(d),u.value}catch(c){return r.value=c.message,null}finally{i.value=!1}}async function C(d,c){i.value=!0,r.value=null;try{const f=await Ce(d,c);return s.value.unshift(f),f}catch(f){throw r.value=f.message,f}finally{i.value=!1}}async function y(d){var c;i.value=!0,r.value=null;try{await $e(d),s.value=s.value.filter(f=>f.id!==d),((c=u.value)==null?void 0:c.id)===d&&(u.value=null,w.value=null)}catch(f){throw r.value=f.message,f}finally{i.value=!1}}async function z(d,c){i.value=!0,r.value=null;try{return w.value=await ke(d,c),w.value}catch(f){throw r.value=f.message,f}finally{i.value=!1}}function V(d){Ue(d)}async function $(d){i.value=!0,r.value=null;try{return await Fe(d)}catch(c){throw r.value=c.message,c}finally{i.value=!1}}async function L(d){try{return await ze(d)}catch(c){throw r.value=c.message,c}}function _(){u.value=null,w.value=null}return{dataSources:s,currentDataSource:u,currentPreview:w,loading:i,error:r,fetchDataSources:b,fetchDataSource:F,uploadDataSource:C,deleteDataSource:y,previewDataSource:z,downloadDataSource:V,analyzeDataSource:$,detectFormat:L,clearCurrentDataSource:_}}),Le={class:"data-manager"},_e={class:"header"},Be={class:"actions"},Me={class:"p-input-icon-left"},Oe={class:"data-grid"},qe=["onClick"],Ne={class:"card-icon"},Pe={class:"card-content"},je={class:"card-header"},Te={class:"card-name"},Ae={class:"card-meta"},Ie={class:"card-actions"},Re={key:0,class:"empty-state"},Ee={class:"upload-content"},Xe={key:0,class:"upload-options"},Je={class:"field"},Ge={class:"field-checkbox"},Ke={key:0,class:"preview-content"},Qe={class:"preview-info"},We={class:"sample-values"},He={class:"stats-grid"},Ye={class:"stat-row"},Ze={class:"stat-row"},ea={class:"stat-row"},aa={class:"stat-row"},ta={class:"stat-row"},la={class:"delete-content"},na=re({__name:"DataManager",setup(s){const u=Ve(),w=v(""),i=v(null),r=v([]),b=v(!1),F=v(!1),C=v(!1),y=v(null),z=v(!1),V=v([]),$=v({encoding:"UTF-8",analyze:!0}),L=v([]),_=v([]),d=v([]),c=v([]),f=[{label:"All Formats",value:null},{label:"CSV",value:"csv"},{label:"JSON",value:"json"},{label:"Excel",value:"xlsx"},{label:"Parquet",value:"parquet"},{label:"XML",value:"xml"}],H=["UTF-8","UTF-16","ISO-8859-1","Windows-1252"],R=de(()=>{let l=r.value;if(w.value){const e=w.value.toLowerCase();l=l.filter(h=>h.name.toLowerCase().includes(e))}return i.value&&(l=l.filter(e=>e.format===i.value)),l});ce(async()=>{await q()});async function q(){r.value=await u.fetchDataSources()}function Y(l){y.value=l}async function Z(l){y.value=l;const e=await u.previewDataSource(l.id);L.value=e.data,_.value=e.columns.map(h=>({field:h,header:h})),d.value=e.schema,c.value=e.schema.filter(h=>["integer","decimal","float"].includes(h.type)),F.value=!0}function ee(l){u.downloadDataSource(l.id)}function ae(l){y.value=l,C.value=!0}async function te(){if(y.value){z.value=!0;try{await u.deleteDataSource(y.value.id),await q(),C.value=!1}finally{z.value=!1}}}function le(l){V.value=l.files}async function ne(l){for(const e of l.files)await u.uploadDataSource(e,$.value);await q(),b.value=!1,V.value=[]}function oe(l){switch(l){case"csv":return"pi pi-file";case"json":return"pi pi-code";case"xlsx":return"pi pi-file-excel";case"parquet":return"pi pi-database";case"xml":return"pi pi-file";default:return"pi pi-file"}}function se(l){switch(l){case"csv":return"success";case"json":return"warning";case"xlsx":return"info";case"parquet":return"secondary";case"xml":return"primary";default:return"info"}}function E(l){return l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:l<1024*1024*1024?`${(l/1024/1024).toFixed(1)} MB`:`${(l/1024/1024/1024).toFixed(1)} GB`}function X(l){return l.toLocaleString()}function ue(l){return new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}return(l,e)=>{var J;const h=ve("tooltip");return S(),g("div",Le,[a("div",_e,[e[11]||(e[11]=a("h1",null,"Data Sources",-1)),a("div",Be,[a("span",Me,[e[10]||(e[10]=a("i",{class:"pi pi-search"},null,-1)),o(n(fe),{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"Search..."},null,8,["modelValue"])]),o(n(K),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),options:f,optionLabel:"label",optionValue:"value",placeholder:"Format"},null,8,["modelValue"]),o(n(k),{label:"Upload",icon:"pi pi-upload",onClick:e[2]||(e[2]=t=>b.value=!0)})])]),a("div",Oe,[(S(!0),g(M,null,O(R.value,t=>(S(),g("div",{key:t.id,class:"data-card",onClick:D=>Y(t)},[a("div",Ne,[a("i",{class:G(oe(t.format))},null,2)]),a("div",Pe,[a("div",je,[a("span",Te,p(t.name),1),o(n(Q),{value:t.format.toUpperCase(),severity:se(t.format)},null,8,["value","severity"])]),a("div",Ae,[a("span",null,[e[12]||(e[12]=a("i",{class:"pi pi-file"},null,-1)),x(" "+p(E(t.sizeBytes)),1)]),a("span",null,[e[13]||(e[13]=a("i",{class:"pi pi-table"},null,-1)),x(" "+p(X(t.rowCount))+" rows",1)]),a("span",null,[e[14]||(e[14]=a("i",{class:"pi pi-clock"},null,-1)),x(" "+p(ue(t.uploadedAt)),1)])])]),a("div",Ie,[j(o(n(k),{icon:"pi pi-eye",class:"p-button-rounded p-button-text",onClick:T(D=>Z(t),["stop"])},null,8,["onClick"]),[[h,"Preview"]]),j(o(n(k),{icon:"pi pi-download",class:"p-button-rounded p-button-text",onClick:T(D=>ee(t),["stop"])},null,8,["onClick"]),[[h,"Download"]]),j(o(n(k),{icon:"pi pi-trash",class:"p-button-rounded p-button-danger p-button-text",onClick:T(D=>ae(t),["stop"])},null,8,["onClick"]),[[h,"Delete"]])])],8,qe))),128))]),R.value.length===0?(S(),g("div",Re,[e[15]||(e[15]=a("i",{class:"pi pi-database",style:{"font-size":"4rem",color:"var(--text-color-secondary)"}},null,-1)),e[16]||(e[16]=a("h3",null,"No data sources yet",-1)),e[17]||(e[17]=a("p",null,"Upload your first data file to get started",-1)),o(n(k),{label:"Upload Data",icon:"pi pi-upload",onClick:e[3]||(e[3]=t=>b.value=!0)})])):N("",!0),o(n(P),{visible:b.value,"onUpdate:visible":e[6]||(e[6]=t=>b.value=t),header:"Upload Data Source",style:{width:"600px"},modal:!0},{default:m(()=>[a("div",Ee,[o(n(me),{mode:"advanced",multiple:!0,accept:".csv,.json,.xlsx,.parquet,.xml,.tsv",maxFileSize:5e8,onUpload:ne,onSelect:le,auto:!1,chooseLabel:"Select Files",uploadLabel:"Upload",cancelLabel:"Clear"},{empty:m(()=>[...e[18]||(e[18]=[a("div",{class:"upload-dropzone"},[a("i",{class:"pi pi-cloud-upload",style:{"font-size":"3rem"}}),a("p",null,"Drag and drop files here"),a("span",{class:"upload-hint"},"CSV, JSON, XLSX, Parquet, XML (max 500MB each)")],-1)])]),_:1}),V.value.length>0?(S(),g("div",Xe,[e[21]||(e[21]=a("h4",null,"Upload Options",-1)),a("div",Je,[e[19]||(e[19]=a("label",{for:"encoding"},"File Encoding",-1)),o(n(K),{id:"encoding",modelValue:$.value.encoding,"onUpdate:modelValue":e[4]||(e[4]=t=>$.value.encoding=t),options:H,class:"w-full"},null,8,["modelValue"])]),a("div",Ge,[o(n(ye),{id:"analyze",modelValue:$.value.analyze,"onUpdate:modelValue":e[5]||(e[5]=t=>$.value.analyze=t),binary:!0},null,8,["modelValue"]),e[20]||(e[20]=a("label",{for:"analyze"},"Analyze file structure",-1))])])):N("",!0)])]),_:1},8,["visible"]),o(n(P),{visible:F.value,"onUpdate:visible":e[7]||(e[7]=t=>F.value=t),header:`Preview: ${(J=y.value)==null?void 0:J.name}`,style:{width:"90vw"},modal:!0},{default:m(()=>[y.value?(S(),g("div",Ke,[a("div",Qe,[a("span",null,[e[22]||(e[22]=a("strong",null,"Format:",-1)),x(" "+p(y.value.format.toUpperCase()),1)]),a("span",null,[e[23]||(e[23]=a("strong",null,"Size:",-1)),x(" "+p(E(y.value.sizeBytes)),1)]),a("span",null,[e[24]||(e[24]=a("strong",null,"Rows:",-1)),x(" "+p(X(y.value.rowCount)),1)]),a("span",null,[e[25]||(e[25]=a("strong",null,"Columns:",-1)),x(" "+p(y.value.columnCount),1)])]),o(n(we),null,{default:m(()=>[o(n(A),{header:"Data Preview"},{default:m(()=>[o(n(W),{value:L.value,rows:10,paginator:!0,class:"p-datatable-sm",responsiveLayout:"scroll"},{default:m(()=>[(S(!0),g(M,null,O(_.value,t=>(S(),pe(n(U),{key:t.field,field:t.field,header:t.header},{body:m(({data:D})=>[a("span",{class:G({"null-value":D[t.field]===null})},p(D[t.field]??"null"),3)]),_:2},1032,["field","header"]))),128))]),_:1},8,["value"])]),_:1}),o(n(A),{header:"Schema"},{default:m(()=>[o(n(W),{value:d.value,class:"p-datatable-sm"},{default:m(()=>[o(n(U),{field:"name",header:"Column",style:{width:"200px"}}),o(n(U),{field:"type",header:"Detected Type",style:{width:"150px"}},{body:m(({data:t})=>[o(n(Q),{value:t.type},null,8,["value"])]),_:1}),o(n(U),{field:"nullCount",header:"Nulls",style:{width:"100px"}},{body:m(({data:t})=>[x(p(t.nullCount)+" ("+p(t.nullPercent)+"%) ",1)]),_:1}),o(n(U),{field:"uniqueCount",header:"Unique Values",style:{width:"120px"}}),o(n(U),{field:"sample",header:"Sample Values"},{body:m(({data:t})=>[a("div",We,[(S(!0),g(M,null,O(t.sample.slice(0,3),(D,B)=>(S(),g("code",{key:B},p(D),1))),128))])]),_:1})]),_:1},8,["value"])]),_:1}),o(n(A),{header:"Statistics"},{default:m(()=>[a("div",He,[(S(!0),g(M,null,O(c.value,t=>{var D,B;return S(),g("div",{key:t.name,class:"stat-card"},[a("h4",null,p(t.name),1),a("div",Ye,[e[26]||(e[26]=a("span",null,"Min:",-1)),a("span",null,p(t.min),1)]),a("div",Ze,[e[27]||(e[27]=a("span",null,"Max:",-1)),a("span",null,p(t.max),1)]),a("div",ea,[e[28]||(e[28]=a("span",null,"Mean:",-1)),a("span",null,p((D=t.mean)==null?void 0:D.toFixed(2)),1)]),a("div",aa,[e[29]||(e[29]=a("span",null,"Median:",-1)),a("span",null,p(t.median),1)]),a("div",ta,[e[30]||(e[30]=a("span",null,"Std Dev:",-1)),a("span",null,p((B=t.stdDev)==null?void 0:B.toFixed(2)),1)])])}),128))])]),_:1})]),_:1})])):N("",!0)]),_:1},8,["visible","header"]),o(n(P),{visible:C.value,"onUpdate:visible":e[9]||(e[9]=t=>C.value=t),header:"Confirm Delete",style:{width:"400px"},modal:!0},{footer:m(()=>[o(n(k),{label:"Cancel",class:"p-button-text",onClick:e[8]||(e[8]=t=>C.value=!1)}),o(n(k),{label:"Delete",class:"p-button-danger",onClick:te,loading:z.value},null,8,["loading"])]),default:m(()=>{var t;return[a("div",la,[e[33]||(e[33]=a("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"var(--yellow-500)"}},null,-1)),a("p",null,[e[31]||(e[31]=x("Are you sure you want to delete ",-1)),a("strong",null,p((t=y.value)==null?void 0:t.name),1),e[32]||(e[32]=x("?",-1))]),e[34]||(e[34]=a("p",{class:"warning-text"},"This action cannot be undone.",-1))])]}),_:1},8,["visible"])])}}}),wa=be(na,[["__scopeId","data-v-3b0c89b6"]]);export{wa as default};
